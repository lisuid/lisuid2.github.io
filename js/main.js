const adjustMenu=(e=!1)=>{const t=document.getElementById("site-name");let n=t&&t.offsetWidth;const o=document.querySelector("#menus .menus_items");let i=o&&o.offsetWidth;const c=document.querySelector("#search-button");let s=c&&c.offsetWidth;e&&(n=t&&t.offsetWidth,i=o&&o.offsetWidth,s=c&&c.offsetWidth);const a=document.getElementById("nav");let l;l=window.innerWidth<768||n+i+s>a.offsetWidth-120,l?a.classList.add("hide-menu"):a.classList.remove("hide-menu")},initAdjust=()=>{adjustMenu(),document.getElementById("nav").classList.add("show")},sidebarFn=()=>{const e=document.getElementById("toggle-menu"),t=document.getElementById("sidebar-menus"),n=document.getElementById("menu-mask"),o=document.body,i=()=>t.classList.contains("open");function c(){o.style.overflow="",o.style.paddingRight="",utils.fadeOut(n,.5),t.classList.remove("open")}e.addEventListener("click",(function(){utils.sidebarPaddingR(),o.style.overflow="hidden",utils.fadeIn(n,.5),t.classList.add("open")})),n.addEventListener("click",(()=>{i()&&c()})),window.addEventListener("resize",(()=>{utils.isHidden(e)&&i()&&c()}))},scrollFn=function(){const e=window.innerHeight,t=document.getElementById("page-header");if(!t||document.body.scrollHeight<=e)return;let n=0;window.addEventListener("scroll",utils.throttle((function(e){const o=window.scrollY||document.documentElement.scrollTop,i=function(e){const t=e>n;return n=e,t}(o);o>0?(t.classList.add("nav-fixed"),i?t.classList.contains("nav-visible")&&t.classList.remove("nav-visible"):t.classList.contains("nav-visible")||t.classList.add("nav-visible")):t.classList.remove("nav-fixed","nav-visible"),percent()}),200))},percent=()=>{let e=document.documentElement.scrollTop||window.pageYOffset,t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-document.documentElement.clientHeight,n=Math.round(e/t*100),o=document.querySelector("#percent"),i=window.scrollY+document.documentElement.clientHeight,c=t-e;(document.getElementById("post-comment")||document.getElementById("footer")).offsetTop<i||n>90?(document.querySelector("#nav-totop").classList.add("long"),o.innerHTML="ËøîÂõûÈ°∂ÈÉ®"):(document.querySelector("#nav-totop").classList.remove("long"),n>=0&&(o.innerHTML=n));let s=document.querySelectorAll(".needEndHide");c<100?s.forEach((function(e){e.classList.add("hide")})):s.forEach((function(e){e.classList.remove("hide")})),window.onscroll=percent},showTodayCard=()=>{const e=document.getElementById("todayCard"),t=document.getElementsByClassName("topGroup")[0];e&&t&&t.addEventListener("mouseleave",(()=>{e.classList.remove("hide")}))},changeTimeFormat=()=>{const e=document.getElementsByTagName("time"),t=GLOBAL_CONFIG.lang.time;for(let n=0;n<e.length;n++){const o=e[n].getAttribute("datetime"),i=new Date(o),c=utils.timeDiff(i,new Date);let s;s=0===c?t.recent:1===c?t.yesterday:2===c?t.berforeyesterday:c<=7?c+t.daybefore:i.getFullYear()!==(new Date).getFullYear()?i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate():i.getMonth()+1+"/"+i.getDate(),e[n].textContent=s}},initObserver=()=>{let e=document.getElementById("post-comment"),t=document.getElementById("pagination");if(e&&t){new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?(t.classList.add("show-window"),document.querySelector(".comment-barrage").style.bottom="-200px"):(t.classList.remove("show-window"),document.querySelector(".comment-barrage").style.bottom="0px")}))})).observe(e)}};class toc{static init(){const e=document.getElementById("card-toc");if(!e||!e.querySelector(".toc a"))return void(e.style.display="none");const t=document.querySelectorAll(".toc a");t.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),utils.scrollToDest(utils.getEleTop(document.getElementById(decodeURI(("toc-text"===e.target.className?e.target.parentNode.hash:e.target.hash).replace("#","")))),300)}))})),this.active(t)}static active(e){const t=document.getElementById("article-container"),n=document.getElementById("toc-content"),o=t.querySelectorAll("h1,h2,h3,h4,h5,h6");let i="";const c=t=>{if(0===t)return!1;let c="";if(o.forEach(((e,n)=>{t>utils.getEleTop(e)-80&&(c=n)})),i===c)return;i=c,document.querySelectorAll(".toc .active").forEach((e=>{e.classList.remove("active")}));const s=e[i];if(s){s.classList.add("active"),(e=>{const t=e.getBoundingClientRect().top,o=n.scrollTop;t>document.documentElement.clientHeight-100&&(n.scrollTop=o+150),t<100&&(n.scrollTop=o-150)})(s);let e=s.parentNode;for(;!e.matches(".toc");)e.matches("li")&&e.classList.add("active"),e=e.parentNode}};window.tocScrollFn=utils.throttle((()=>{const e=window.scrollY||document.documentElement.scrollTop;c(e)}),100),window.addEventListener("scroll",tocScrollFn)}}let lastSayHello="",wleelw_musicPlaying=!1,sco={card_welcome:function(){if(ipLoacation=window.saveToLocal.get("ipLocation"),!ipLoacation){let e=document.createElement("script"),t=`https://apis.map.qq.com/ws/location/v1/ip?key=${txkey}&output=jsonp`;e.src=t,window.QQmap=function(t){ipLoacation=t,window.saveToLocal.set("ipLocation",ipLoacation,1),document.body.removeChild(e),delete window.QQmap},document.body.appendChild(e)}showWelcome()},card_history:function(){if(document.getElementById("history-container")){(async function(){let e=new Date,t=e.getMonth()+1,n=e.getDate(),o=t<10?"0"+t:""+t,i="S"+o+(n<10?"0"+n:""+n),c=`https://cdn.meuicat.com/gh/Zfour/Butterfly-card-history@2.08/${o}.json`,s=await fetch(c);return(await s.json())[i]})().then((e=>{let t=e.map((e=>`\n            <div class="swiper-slide history_slide">\n                <span class="history_slide_time">A.D.${e.year}</span>\n                <span class="history_slide_link">${e.title}</span>\n            </div>\n        `)).join("");!function(e,t){let n=document.createElement("div");n.innerHTML=t;let o=document.createDocumentFragment();for(;n.firstChild;)o.appendChild(n.firstChild);e.appendChild(o)}(document.getElementById("history_container_wrapper"),t);let n=new Swiper(".history_swiper-container",{passiveListeners:!0,spaceBetween:30,effect:"coverflow",coverflowEffect:{rotate:30,slideShadows:!1},loop:!0,direction:"vertical",autoplay:{disableOnInteraction:!0,delay:5e3},mousewheel:!1}),o=document.getElementById("history-container");o.onmouseenter=function(){n.autoplay.stop()},o.onmouseleave=function(){n.autoplay.start()}}))}},hideCookie:function(){setTimeout((()=>{const e=document.getElementById("cookies-window");e&&(e.classList.add("cw-hide"),setTimeout((()=>{e.style.display="none"}),1e3))}),3e3)},scrollTo:function(e){const t=document.getElementById(e);if(t){const e=t.getBoundingClientRect().top+window.pageYOffset-80,n=window.pageYOffset,o=e-n;let i=null;window.requestAnimationFrame((function e(t){i=i||t;const c=t-i,s=Math.min(c/0,1),a=s<.5?2*s*s:(4-2*s)*s-1;window.scrollTo(0,n+o*a),c<600&&window.requestAnimationFrame(e)}))}},switchCommentBarrage:function(){let e=document.querySelector(".comment-barrage");e&&("flex"===window.getComputedStyle(e).display?(e.style.display="none",document.querySelector(".menu-commentBarrage-text").textContent="ÊòæÁ§∫ÁÉ≠ËØÑ",document.querySelector("#consoleCommentBarrage").classList.remove("on"),localStorage.removeItem("commentBarrageSwitch")):(e.style.display="flex",document.querySelector(".menu-commentBarrage-text").textContent="ÂÖ≥Èó≠ÁÉ≠ËØÑ",document.querySelector("#consoleCommentBarrage").classList.add("on"),localStorage.setItem("commentBarrageSwitch","false")))},switchHideAside:function(){const e=document.documentElement.classList;e.contains("hide-aside")?saveToLocal.set("aside-status","show",1):saveToLocal.set("aside-status","hide",1),e.toggle("hide-aside"),e.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")},initConsoleState:function(){document.documentElement.classList.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")},changeSayHelloText:function(){const e=["ü§ñÔ∏è Êï∞Á†ÅÁßëÊäÄÁà±Â•ΩËÄÖ","üîç ÂàÜ‰∫´‰∏éÁÉ≠ÂøÉÂ∏ÆÂä©","üè† Êô∫ËÉΩÂÆ∂Â±ÖÂ∞èËÉΩÊâã","üî® ËÆæËÆ°ÂºÄÂèë‰∏ÄÊù°Èæô","ü§ù ‰∏ì‰øÆ‰∫§‰∫í‰∏éËÆæËÆ°","üèÉ ËÑöË∏èÂÆûÂú∞Ë°åÂä®Ê¥æ","üß± Âõ¢ÈòüÂ∞èÁªÑÂèëÂä®Êú∫","üí¢ Â£ÆÊ±â‰∫∫Áã†ËØù‰∏çÂ§ö"],t=document.getElementById("author-info__sayhi");let n=e[Math.floor(Math.random()*e.length)];for(;n===lastSayHello;)n=e[Math.floor(Math.random()*e.length)];t.textContent=n,lastSayHello=n},switchDarkMode:function(){"light"===("dark"===document.documentElement.getAttribute("data-theme")?"dark":"light")?(document.documentElement.setAttribute("data-theme","dark"),saveToLocal.set("theme","dark",.04),utils.snackbarShow(GLOBAL_CONFIG.lang.theme.dark,!1,2e3),document.querySelector(".menu-darkmode-text").textContent="Ê∑±Ëâ≤Ê®°Âºè"):(document.documentElement.setAttribute("data-theme","light"),saveToLocal.set("theme","light",.04),utils.snackbarShow(GLOBAL_CONFIG.lang.theme.light,!1,2e3),document.querySelector(".menu-darkmode-text").textContent="ÊµÖËâ≤Ê®°Âºè")},hideTodayCard:function(){document.getElementById("todayCard").classList.add("hide")},toTop:function(){utils.scrollToDest(0)},showConsole:function(){let e=document.getElementById("console");e.classList.contains("show")||e.classList.add("show")},hideConsole:function(){const e=document.getElementById("console");e.classList.contains("show")&&e.classList.remove("show")},lightbox:function(){window.ViewImage&&window.ViewImage.init("#article-container img:not(.flink-avatar), .bber-content-img img, #album_detail img, #equipment img, #twikoo .tk-content img:not(.tk-owo-emotion)")},initTheme:function(){let e=window.matchMedia("(prefers-color-scheme: dark)").matches;try{const t=saveToLocal.get("theme");if(void 0===t){const t=e?"dark":"light";document.documentElement.setAttribute("data-theme",t),saveToLocal.set("theme",t,.5)}else document.documentElement.setAttribute("data-theme",t)}catch(t){e?saveToLocal.set("theme","dark",.5):saveToLocal.set("theme","light",.5)}},reflashEssayWaterFall:function(){document.getElementById("waterfall")&&setTimeout((function(){waterfall("#waterfall"),document.getElementById("waterfall").classList.add("show")}),500)},addRuntime:function(){let e=document.getElementById("runtimeshow");e&&GLOBAL_CONFIG.runtime&&(e.innerText=utils.timeDiff(new Date(GLOBAL_CONFIG.runtime),new Date)+GLOBAL_CONFIG.lang.time.runtime)},lazyloadImg:function(){window.lazyLoadInstance=new LazyLoad({elements_selector:"img",threshold:0,data_src:"lazy-src",callback_error:e=>{e.setAttribute("src",GLOBAL_CONFIG.lazyload.error)}})},toTalk:function(e){const t=document.querySelector(".el-textarea__inner"),n=new Event("input",{bubbles:!0,cancelable:!0}),o=e.replace(/\n/g,"\n> ");t.value="> "+o+"\n\n",t.dispatchEvent(n),utils.scrollToDest(utils.getEleTop(document.getElementById("post-comment")),300),t.focus(),t.setSelectionRange(-1,-1);const i=document.querySelector("#comment-tips");i&&i.classList.add("show")},initbbtalk:function(){if(document.querySelector("#bber-talk")){new Swiper(".swiper-container",{direction:"vertical",loop:!0,autoplay:{delay:3e3,pauseOnMouseEnter:!0}})}},addPhotoFigcaption:function(){document.querySelectorAll("#article-container img").forEach((e=>{const t=e.parentNode,n=e.getAttribute("alt");if(n){const o=document.createElement("div");o.className="img-alt is-center",o.textContent=n,t.insertBefore(o,e.nextSibling)}}))},downloadImage:async function(e,t){if(rm.hideRightMenu(),rm.downloadimging)utils.snackbarShow("ÊúâÊ≠£Âú®ËøõË°å‰∏≠ÁöÑ‰∏ãËΩΩÔºåËØ∑Á®çÂêéÂÜçËØï");else try{rm.downloadimging=!0,utils.snackbarShow("Ê≠£Âú®‰∏ãËΩΩ‰∏≠ÔºåËØ∑Á®çÂêé",!1,1e4),await new Promise((e=>setTimeout(e,1e4)));const n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){const e=document.createElement("canvas"),o=e.getContext("2d");e.width=n.width,e.height=n.height,o.drawImage(n,0,0,n.width,n.height),o.font="30px Arial",o.fillText(window.location.href,10,n.height-10);const i=e.toDataURL("image/png"),c=document.createElement("a"),s=new MouseEvent("click");c.download=t||"photo",c.href=i,c.dispatchEvent(s),utils.snackbarShow("ÂõæÁâáÂ∑≤Ê∑ªÂä†Áõ≤Ê∞¥Âç∞ÔºåËØ∑ÈÅµÂÆàÁâàÊùÉÂçèËÆÆ"),rm.downloadimging=!1},n.src=e}catch(e){console.error(e),utils.snackbarShow("‰∏ãËΩΩÂõæÁâáÊó∂Âá∫Èîô"),rm.downloadimging=!1}},musicToggle:function(){const e=document.querySelector("#nav-music"),t=document.querySelector("meting-js"),n=document.getElementById("consoleMusic"),o=document.getElementById("menu-music-toggle");wleelw_musicPlaying=!wleelw_musicPlaying,e.classList.toggle("playing",wleelw_musicPlaying),n.classList.toggle("on",wleelw_musicPlaying),wleelw_musicPlaying?(t.aplayer.play(),o.innerHTML='<i class="scoicon sco-pause-fill"></i><span>ÊöÇÂÅúÈü≥‰πê</span>'):(t.aplayer.pause(),o.innerHTML='<i class="scoicon sco-play-fill"></i><span>Êí≠ÊîæÈü≥‰πê</span>'),rm.hideRightMenu()},musicSkipBack:function(){document.querySelector("meting-js").aplayer.skipBack(),rm.hideRightMenu()},musicSkipForward:function(){document.querySelector("meting-js").aplayer.skipForward(),rm.hideRightMenu()},musicGetName:function(){return Array.from(document.querySelectorAll(".aplayer-title")).map((e=>e.innerText))[0]},scrollToComment:function(){utils.scrollToDest(utils.getEleTop(document.getElementById("post-comment")),300)},setFest:function(){const e=new Date,t=`${e.getMonth()+1}.${e.getDate()}`;if(["1.8","9.9","7.7","9.18","12.13"].includes(t)){const e="\n        html {\n            filter: grayscale(100%);\n        }\n        ",t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}},setTimeState:function(){const e=document.getElementById("author-info__sayhi");if(e){const t=(new Date).getHours(),n=GLOBAL_CONFIG.lang.sayhello,o=[{start:0,end:5,text:n.goodnight},{start:6,end:10,text:n.morning},{start:11,end:14,text:n.noon},{start:15,end:18,text:n.afternoon},{start:19,end:24,text:n.night}];for(let n of o)if(t>=n.start&&t<=n.end){e.innerText=n.text;break}}},tagPageActive:function(){const e=window.location.pathname,t=decodeURIComponent(e);if(/\/tags\/.*?\//.test(t)){const e=t.split("/").slice(-2,-1)[0];if(document.getElementById("#tag-page-tags")){document.querySelectorAll("a").forEach((e=>{e.classList.remove("select")}));const t=document.getElementById(e);t&&t.classList.add("select")}}},categoriesBarActive:function(){const e=document.querySelector("#category-bar"),t=window.location.pathname,n=decodeURIComponent(t);if(e){document.querySelectorAll(".category-bar-item").forEach((e=>{e.classList.remove("select")}))}if("/"===n){if(e){document.getElementById("category-bar-home").classList.add("select")}}else if(/\/categories\/.*?\//.test(n)){let t=n.split("/").slice(-2,-1)[0];if(t=t.charAt(0).toUpperCase()+t.slice(1),e){const e=document.getElementById(t);e&&e.classList.add("select")}}},scrollCategoryBarToRight:function(){let e,t=document.getElementById("category-bar-items"),n=document.getElementById("category-bar-next"),o=t.clientWidth;t&&(t.scrollLeft+t.clientWidth>=t.scrollWidth-8?t.scroll({left:0,behavior:"smooth"}):t.scrollBy({left:o,behavior:"smooth"}),t.addEventListener("scroll",(function o(){clearTimeout(e),e=setTimeout((function(){t.scrollLeft+t.clientWidth>=t.scrollWidth-8?n.style.transform="rotate(180deg)":n.style.transform="",t.removeEventListener("scroll",o)}),150)})))},openAllTags:function(){document.querySelectorAll(".card-allinfo .card-tag-cloud").forEach((function(e){e.classList.add("all-tags")}));let e=document.getElementById("more-tags-btn");e&&e.parentNode.removeChild(e)},listenToPageInputPress:function(){const e=document.getElementById("toPageText"),t=document.getElementById("toPageButton");if(!e)return;const n=document.querySelectorAll(".page-number");if(1===+n[n.length-1].textContent){const e=document.querySelector(".toPageGroup");e&&e.remove()}e.addEventListener("keydown",(e=>{13===e.keyCode&&(heo.toPage(),pjax.loadUrl(t.href))})),e.addEventListener("input",(()=>{""===e.value||"0"===e.value?t.classList.remove("haveValue"):t.classList.add("haveValue");const n=document.querySelectorAll(".page-number"),o=+n[n.length-1].textContent;+e.value>o&&(e.value=o)}))},addNavBackgroundInit:function(){if(0!==(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0)){var e=document.getElementById("page-header");e&&e.classList.add("nav-fixed","nav-visible");var t=document.getElementById("cookies-window");t&&(t.style.display="none")}}};class hightlight{static createEle(e,t){const n=document.createDocumentFragment(),o=document.createElement("div");o.className="highlight-tools",o.innerHTML=`<i class="scoicon sco-arrow-down expand" style="font-size: 16px"></i>${e}<i class="scoicon sco-copy-fill"></i>`;const i=t.clientHeight,c=t.querySelector("table"),s=t.getElementsByClassName("code-expand-btn");let a=!0;if(o.children[0].addEventListener("click",(()=>{a=!a,o.children[0].classList.toggle("closed"),c.style.display=a?"none":"block",0!==s.length&&(s[0].style.display=a?"none":"block"),a||(c.style.height=i<200?"auto":"200px",i>=200&&t.classList.remove("expand-done"))})),o.children[2].addEventListener("click",(()=>{utils.copy(c.querySelector(".code").innerText)})),n.appendChild(o),GLOBAL_CONFIG.hightlight.limit&&i>GLOBAL_CONFIG.hightlight.limit+30){c.style.height=`${GLOBAL_CONFIG.hightlight.limit}px`;const e=document.createElement("div");e.className="code-expand-btn",e.innerHTML='<i class="scoicon sco-show-line" style="font-size: 1.2rem"></i>',e.addEventListener("click",(e=>{c.style.height=`${i}px`;("code-expand-btn"!==e.target.className?e.target.parentNode:e.target).classList.add("expand-done")})),n.appendChild(e)}t.insertBefore(n,t.firstChild)}static init(){document.querySelectorAll("figure.highlight").forEach((e=>{let t=e.classList[1]||"Code";"plaintext"===t&&(t="Code");const n=`<div class="code-lang">${t.toUpperCase()}</div>`;this.createEle(n,e)}))}}class tabs{static init(){this.clickFnOfTabs(),this.backToTop()}static clickFnOfTabs(){document.querySelectorAll("#article-container .tab > button").forEach((function(e){e.addEventListener("click",(function(e){const t=this,n=t.parentNode;if(!n.classList.contains("active")){const e=n.parentNode.nextElementSibling,o=utils.siblings(n,".active")[0];o&&o.classList.remove("active"),n.classList.add("active");const i=t.getAttribute("data-href").replace("#","");[...e.children].forEach((e=>{e.id===i?e.classList.add("active"):e.classList.remove("active")}))}}))}))}static backToTop(){document.querySelectorAll("#article-container .tabs .tab-to-top").forEach((function(e){e.addEventListener("click",(function(){utils.scrollToDest(utils.getEleTop(e.parentElement.parentElement.parentNode),300)}))}))}}window.refreshFn=()=>{"404"!==PAGE_CONFIG.page&&(initAdjust(),scrollFn(),sidebarFn(),changeTimeFormat(),initObserver(),sco.addRuntime(),sco.hideCookie(),sco.addPhotoFigcaption(),sco.setFest(),sco.setTimeState(),sco.tagPageActive(),sco.categoriesBarActive(),sco.listenToPageInputPress(),sco.addNavBackgroundInit(),GLOBAL_CONFIG.rightside.enable&&addRightMenuClickEvent(),GLOBAL_CONFIG.lazyload.enable&&sco.lazyloadImg(),GLOBAL_CONFIG.lightbox&&sco.lightbox(""),GLOBAL_CONFIG.randomlinks&&randomLinksList(),GLOBAL_CONFIG.comment.enable&&newestCommentInit(),PAGE_CONFIG.comment&&initComment(),PAGE_CONFIG.toc&&toc.init(),(PAGE_CONFIG.is_post||PAGE_CONFIG.is_page)&&(GLOBAL_CONFIG.hightlight.enable&&hightlight.init(),tabs.init()),PAGE_CONFIG.is_home&&(showTodayCard(),sco.initbbtalk()),GLOBAL_CONFIG.covercolor&&coverColor(),sco.initConsoleState(),document.getElementById("history-baidu")&&sco.card_history(),document.getElementById("welcome-info")&&sco.card_welcome(),"twikoo"===GLOBAL_CONFIG.comment.type&&PAGE_CONFIG.comment&&initializeCommentBarrage())},sco.initTheme(),document.addEventListener("DOMContentLoaded",(function(){window.refreshFn()})),document.addEventListener("pjax:complete",(()=>{window.refreshFn()})),window.onkeydown=function(e){123===e.keyCode&&utils.snackbarShow("ÂºÄÂèëËÄÖÊ®°ÂºèÂ∑≤ÊâìÂºÄÔºåËØ∑ÈÅµÂæ™GPLÂçèËÆÆ",!1,3e3)};