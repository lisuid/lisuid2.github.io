function set_fest(){let e=new Date;switch((e.getMonth()+1).toString()+"."+e.getDate()){case"1.8":case"9.9":case"7.7":case"9.18":case"12.13":{const e=document.createElement("style"),t="\n              html {\n                -webkit-filter: grayscale(100%);\n                -moz-filter: grayscale(100%);\n                -ms-filter: grayscale(100%);\n                -o-filter: grayscale(100%);\n                filter: progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);\n                _filter: none;\n              }\n            ";e.appendChild(document.createTextNode(t)),document.head.appendChild(e)}}}function setFixed(e){if(!e)return;(window.scrollY||document.documentElement.scrollTop)>0?e.classList.add("nav-fixed"):e.classList.remove("nav-fixed")}function getTimeState(){var e=(new Date).getHours(),t="";return e>=0&&e<=5?t="ç¡ä¸ªå¥½è§‰ï¼Œä¿è¯ç²¾åŠ›å……æ²›":e>5&&e<=10?t="ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨":e>10&&e<=14?t="åƒé¥±äº†æ‰æœ‰åŠ›æ°”å¹²æ´»":e>14&&e<=18?t="é›†ä¸­ç²¾åŠ›ï¼Œæ”»å…‹éš¾å…³":e>18&&e<=24&&(t="ä¸è¦å¤ªåŠ³ç´¯äº†ï¼Œæ—©ç¡æ›´å¥åº·"),t}const scrollFn=function(){const e=window.innerHeight+0,t=document.getElementById("page-header");if(setFixed(t),document.body.scrollHeight<=e)return;let n=0;window.addEventListener("scroll",utils.throttle((function(e){const o=window.scrollY||document.documentElement.scrollTop,i=function(e){const t=e>n;return n=e,t}(o);o>0?(i?t.classList.contains("nav-visible")&&t.classList.remove("nav-visible"):t.classList.contains("nav-visible")||t.classList.add("nav-visible"),t.classList.add("nav-fixed")):0===o&&t.classList.remove("nav-fixed","nav-visible"),percent()}),200))},sidebarFn=()=>{const e=document.getElementById("toggle-menu"),t=document.getElementById("sidebar-menus"),n=document.getElementById("menu-mask"),o=document.getElementById("cookies-window"),i=document.getElementById("page-header"),s=document.body;if(!e)return;let a=0;const c="function"==typeof chatBtnHide,l="function"==typeof chatBtnShow;function d(){s.style.overflow="",s.style.paddingRight="",utils.fadeOut(n,.5),t.classList.remove("open")}e.addEventListener("click",(function(){utils.sidebarPaddingR(),s.style.overflow="hidden",utils.fadeIn(n,.5),t.classList.add("open")})),n.addEventListener("click",(e=>{t.classList.contains("open")&&d()})),window.addEventListener("resize",(e=>{t.classList.contains("open")&&d()})),window.addEventListener("scroll",(e=>{const t=window.scrollY||document.documentElement.scrollTop,n=function(e){const t=e>a;return a=e,t}(t);t>0?(n?(i.classList.contains("nav-visible")&&i.classList.remove("nav-visible"),l&&!0===isChatShow&&(chatBtnHide(),isChatShow=!1)):(i.classList.contains("nav-visible")||i.classList.add("nav-visible"),c&&!1===isChatShow&&(chatBtnShow(),isChatShow=!0)),i.classList.add("nav-fixed"),o.classList.add("cw-hide")):0===t&&i.classList.remove("nav-fixed","nav-visible")}),200)},showTodayCard=()=>{const e=document.getElementById("todayCard");e&&document.getElementsByClassName("topGroup")[0].addEventListener("mouseleave",(()=>{e.classList.contains("hide")&&e.classList.remove("hide")}))},setTimeState=()=>{const e=document.getElementById("author-info__sayhi");if(e){const t=(new Date).getHours(),n=GLOBALCONFIG.lang.sayhello;let o="";t>=0&&t<=5?o=n.goodnight:t>5&&t<=10?o=n.morning:t>10&&t<=14?o=n.noon:t>14&&t<=18?o=n.afternoon:t>18&&t<=24&&(o=n.night),e.innerText=o+n.iam}},chageTimeFormate=()=>{const e=document.getElementsByTagName("time"),t=GLOBALCONFIG.lang.time;for(var n=0;n<e.length;n++){const i=e[n].getAttribute("datetime"),s=new Date(i),a=utils.timeDiff(s,new Date);var o;o=0===a?t.recent:1===a?t.yesterday:2===a?t.berforeyesterday:a<=7?a+t.daybefore:s.getFullYear()!==(new Date).getFullYear()?s.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getDate():s.getMonth()+1+"/"+s.getDate(),e[n].textContent=o}},initObserver=()=>{let e=document.getElementById("post-comment"),t=document.getElementById("pagination");if(e&&t){new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?(t.classList.add("show-window"),document.querySelector(".comment-barrage").style.bottom="-200px"):(t.classList.remove("show-window"),document.querySelector(".comment-barrage").style.bottom="0px")}))})).observe(e)}},percent=()=>{let e=document.documentElement.scrollTop||window.pageYOffset,t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-document.documentElement.clientHeight,n=Math.round(e/t*100),o=document.querySelector("#percent");const i=window.scrollY+document.documentElement.clientHeight,s=document.getElementById("post-tools")||document.getElementById("footer");s.offsetTop+s.offsetHeight/2>i||n>90?(document.querySelector("#nav-totop").classList.add("long"),o.innerHTML=GLOBALCONFIG.lang.backtop,document.querySelectorAll(".needEndHide").forEach((e=>{e.classList.add("hide")}))):(document.querySelector("#nav-totop").classList.remove("long"),n>=0&&(o.innerHTML=n,document.querySelectorAll(".needEndHide").forEach((e=>{e.classList.remove("hide")}))))};class toc{static init(){const e=document.getElementById("card-toc");if(!e||!e.querySelector(".toc a"))return void(e.style.display="none");const t=document.querySelectorAll(".toc a");t.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),utils.scrollToDest(utils.getEleTop(document.getElementById(decodeURI(("toc-text"===e.target.className?e.target.parentNode.hash:e.target.hash).replace("#","")))),300)}))})),this.active(t)}static active(e){const t=document.getElementById("article-container"),n=document.getElementById("toc-content"),o=t.querySelectorAll("h1,h2,h3,h4,h5,h6");let i="";function s(t){if(0===t)return!1;let s="";if(o.forEach((function(e,n){t>utils.getEleTop(e)-80&&(s=n)})),i===s)return;i=s,document.querySelectorAll(".toc .active").forEach((e=>{e.classList.remove("active")}));const a=e[i];if(a){let t=e[i].parentNode;for(a.classList.add("active"),function(e){const t=e.getBoundingClientRect().top,o=n.scrollTop;t>document.documentElement.clientHeight-100&&(n.scrollTop=o+150),t<100&&(n.scrollTop=o-150)}(a);!t.matches(".toc");t=t.parentNode)t.matches("li")&&t.classList.add("active")}}window.tocScrollFn=utils.throttle((function(){s(window.scrollY||document.documentElement.scrollTop)}),100),window.addEventListener("scroll",tocScrollFn)}}let lastSayHello="";class sco{static card_welcome(){if(ipLoacation=window.saveToLocal.get("ipLocation"),ipLoacation);else{var e=document.createElement("script"),t=`https://apis.map.qq.com/ws/location/v1/ip?key=${txkey}&output=jsonp`;e.src=t,window.QQmap=function(t){ipLoacation=t,window.saveToLocal.set("ipLocation",ipLoacation,1),document.body.removeChild(e),delete window.QQmap},document.body.appendChild(e)}showWelcome()}static card_history(){if(document.getElementById("history-container")){function e(e,t){if("string"==typeof t){let n=document.createElement("div");n.innerHTML=t;let o=document.createDocumentFragment();for(;n.firstChild;)o.appendChild(n.firstChild);e.appendChild(o)}else e.appendChild(t)}let t=sco.history_get_data();fetch(t[0]).then((e=>e.json())).then((n=>{let o="";for(let e of n[t[1]])o+='<div class="swiper-slide history_slide"><span class="history_slide_time">A.D.'+e.year+'</span><span class="history_slide_link">'+e.title+"</span></div>";e(document.getElementById("history_container_wrapper"),o);var i=new Swiper(".history_swiper-container",{passiveListeners:!0,spaceBetween:30,effect:"coverflow",coverflowEffect:{rotate:30,slideShadows:!1},loop:!0,direction:"vertical",autoplay:{disableOnInteraction:!0,delay:5e3},mousewheel:!1});let s=document.getElementById("history-container");s.onmouseenter=function(){i.autoplay.stop()},s.onmouseleave=function(){i.autoplay.start()}}))}}static history_get_data(){let e,t=new Date,n=t.getMonth()+1;e=n<10?"0"+String(n):String(n);let o=String(t.getDate());return o=o<10?"0"+String(o):String(o),["https://cdn.meuicat.com/gh/Zfour/Butterfly-card-history@2.08/"+e+".json","S"+e+o]}static hideCookie(){setTimeout((()=>{const e=document.getElementById("cookies-window");e&&(e.classList.add("cw-hide"),setTimeout((()=>{e.style.display="none"}),1e3))}),3e3)}static scrollTo(e){const t=document.getElementById(e);if(t){const e=t.getBoundingClientRect().top+window.pageYOffset-80,n=window.pageYOffset,o=e-n;let i=null;window.requestAnimationFrame((function e(t){i||(i=t);const s=t-i,a=(c=Math.min(s/0,1))<.5?2*c*c:(4-2*c)*c-1;var c;window.scrollTo(0,n+o*a),s<600&&window.requestAnimationFrame(e)}))}}static switchCommentBarrage(){var e=document.querySelector(".comment-barrage");e&&("flex"===window.getComputedStyle(e).display?(e.style.display="none",document.querySelector(".menu-commentBarrage-text").textContent="æ˜¾ç¤ºçƒ­è¯„",document.querySelector("#consoleCommentBarrage").classList.remove("on"),localStorage.removeItem("commentBarrageSwitch")):(e.style.display="flex",document.querySelector(".menu-commentBarrage-text").textContent="å…³é—­çƒ­è¯„",document.querySelector("#consoleCommentBarrage").classList.add("on"),localStorage.setItem("commentBarrageSwitch","false")))}static switchHideAside(){const e=document.documentElement.classList;e.contains("hide-aside")?saveToLocal.set("aside-status","show",2):saveToLocal.set("aside-status","hide",2),e.toggle("hide-aside"),e.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")}static initConsoleState(){document.documentElement.classList.contains("hide-aside")?document.querySelector("#consoleHideAside").classList.add("on"):document.querySelector("#consoleHideAside").classList.remove("on")}static sayhi(){document.querySelector("#author-info__sayhi")&&(document.getElementById("author-info__sayhi").innerHTML=getTimeState())}static changeSayHelloText(){const e=["ğŸ¤–ï¸ æ•°ç ç§‘æŠ€çˆ±å¥½è€…","ğŸ” åˆ†äº«ä¸çƒ­å¿ƒå¸®åŠ©","ğŸ  æ™ºèƒ½å®¶å±…å°èƒ½æ‰‹","ğŸ”¨ è®¾è®¡å¼€å‘ä¸€æ¡é¾™","ğŸ¤ ä¸“ä¿®äº¤äº’ä¸è®¾è®¡","ğŸƒ è„šè¸å®åœ°è¡ŒåŠ¨æ´¾","ğŸ§± å›¢é˜Ÿå°ç»„å‘åŠ¨æœº","ğŸ’¢ å£®æ±‰äººç‹ è¯ä¸å¤š"],t=document.getElementById("author-info__sayhi");let n=e[Math.floor(Math.random()*e.length)];for(;n===lastSayHello;)n=e[Math.floor(Math.random()*e.length)];t.textContent=n,lastSayHello=n}static switchDarkMode(){"light"===("dark"===document.documentElement.getAttribute("data-theme")?"dark":"light")?(document.documentElement.setAttribute("data-theme","dark"),saveToLocal.set("theme","dark",.04),utils.snackbarShow(GLOBALCONFIG.lang.theme.dark,!1,2e3),document.querySelector(".menu-darkmode-text").textContent="æ·±è‰²æ¨¡å¼"):(document.documentElement.setAttribute("data-theme","light"),saveToLocal.set("theme","light",.04),utils.snackbarShow(GLOBALCONFIG.lang.theme.light,!1,2e3),document.querySelector(".menu-darkmode-text").textContent="æµ…è‰²æ¨¡å¼")}static hideTodayCard(){document.getElementById("todayCard").classList.add("hide")}static toTop(){utils.scrollToDest(0)}static showConsole(){const e=document.getElementById("console");e.classList.contains("show")||e.classList.add("show")}static hideConsole(){const e=document.getElementById("console");e.classList.contains("show")&&e.classList.remove("show")}static lightbox(e){window.ViewImage&&window.ViewImage.init("#article-container img:not(.flink-avatar), .bber-content-img img, #album_detail img, #equipment img, #twikoo .tk-content img:not(.tk-owo-emotion)")}static initTheme(){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;try{const t=saveToLocal.get("theme");if(void 0===t){const t=e?"dark":"light";document.documentElement.setAttribute("data-theme",t),saveToLocal.set("theme",t,.5)}else document.documentElement.setAttribute("data-theme",t)}catch(t){e?saveToLocal.set("theme","dark",.5):saveToLocal.set("theme","light",.5)}}static reflashEssayWaterFall(){document.getElementById("waterfall")&&setTimeout((function(){waterfall("#waterfall"),document.getElementById("waterfall").classList.add("show")}),500)}static addRuntime(){const e=document.getElementById("runtimeshow");e&&GLOBALCONFIG.runtime&&(e.innerText=utils.timeDiff(new Date(GLOBALCONFIG.runtime),new Date)+GLOBALCONFIG.lang.time.runtime)}static lazyloadImg(){window.lazyLoadInstance=new LazyLoad({elements_selector:"img",threshold:0,data_src:"lazy-src",callback_error:e=>{e.setAttribute("src",GLOBALCONFIG.lazyload.error)}})}static toTalk(e){const t=document.querySelector(".el-textarea__inner"),n=new Event("input",{bubbles:!0,cancelable:!0}),o=e.replace(/\n/g,"\n> ");t.value="> "+o+"\n\n",t.dispatchEvent(n),utils.scrollToDest(utils.getEleTop(document.getElementById("post-comment")),300),t.focus(),t.setSelectionRange(-1,-1);const i=document.querySelector("#comment-tips");i&&i.classList.add("show")}static initbbtalk(){if(document.querySelector("#bber-talk"))new Swiper(".swiper-container",{direction:"vertical",loop:!0,autoplay:{delay:3e3,pauseOnMouseEnter:!0}})}static addPhotoFigcaption(){document.querySelectorAll("#article-container img").forEach((e=>{const t=e.parentNode,n=e.getAttribute("alt");if(n){const o=document.createElement("div");o.className="img-alt is-center",o.textContent=n,t.insertBefore(o,e.nextSibling)}}))}static downloadImage(e,t){rm.hideRightMenu(),0==rm.downloadimging?(rm.downloadimging=!0,utils.snackbarShow("æ­£åœ¨ä¸‹è½½ä¸­ï¼Œè¯·ç¨å",!1,1e4),setTimeout((function(){let n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){let e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,n.width,n.height);let o=e.toDataURL("image/png"),i=document.createElement("a"),s=new MouseEvent("click");i.download=t||"photo",i.href=o,i.dispatchEvent(s)},n.src=e,utils.snackbarShow("å›¾ç‰‡å·²æ·»åŠ ç›²æ°´å°ï¼Œè¯·éµå®ˆç‰ˆæƒåè®®"),rm.downloadimging=!1}),"10000")):utils.snackbarShow("æœ‰æ­£åœ¨è¿›è¡Œä¸­çš„ä¸‹è½½ï¼Œè¯·ç¨åå†è¯•")}static musicToggle(){const e=document.querySelector("#nav-music"),t=document.querySelector("meting-js"),n=document.getElementById("consoleMusic");wleelw_musicPlaying?(e.classList.remove("playing"),n.classList.remove("on"),wleelw_musicPlaying=!1,t.aplayer.pause(),document.getElementById("menu-music-toggle").innerHTML='<i class="scoicon sco-play-fill"></i><span>æ’­æ”¾éŸ³ä¹</span>'):(e.classList.add("playing"),n.classList.add("on"),wleelw_musicPlaying=!0,t.aplayer.play(),document.getElementById("menu-music-toggle").innerHTML='<i class="scoicon sco-pause-fill"></i><span>æš‚åœéŸ³ä¹</span>'),rm.hideRightMenu()}static musicSkipBack(){document.querySelector("meting-js").aplayer.skipBack(),rm.hideRightMenu()}static musicSkipForward(){document.querySelector("meting-js").aplayer.skipForward(),rm.hideRightMenu()}static musicGetName(){for(var e=document.querySelectorAll(".aplayer-title"),t=[],n=e.length-1;n>=0;n--)t[n]=e[n].innerText;return t[0]}static scrollToComment(){utils.scrollToDest(utils.getEleTop(document.getElementById("post-comment")),300)}}class hightlight{static createEle(e,t){const n=document.createDocumentFragment(),o=document.createElement("div");o.className="highlight-tools",o.innerHTML='<i class="scoicon sco-arrow-down expand" style="font-size: 16px"></i>'+e+'<i class="scoicon sco-copy-fill"></i>';let i=!0;o.children[0].addEventListener("click",(e=>{i?(o.children[0].classList.add("closed"),c.setAttribute("style","display:none"),0!==l.length&&l[0].setAttribute("style","display:none")):(o.children[0].classList.remove("closed"),c.setAttribute("style","display:block"),0!==l.length&&l[0].setAttribute("style","display:block"),a<200?c.setAttribute("style","height: auto"):(c.setAttribute("style","height:200px"),s.classList.remove("expand-done"))),i=!i})),o.children[2].addEventListener("click",(e=>{utils.copy(c.querySelector(".code").innerText)}));const s=document.createElement("div");n.appendChild(o);const a=t.clientHeight,c=t.querySelector("table"),l=t.getElementsByClassName("code-expand-btn");GLOBALCONFIG.hightlight.limit&&a>GLOBALCONFIG.hightlight.limit+30&&(c.setAttribute("style",`height: ${GLOBALCONFIG.hightlight.limit}px`),s.className="code-expand-btn",s.innerHTML='<i class="scoicon sco-show-line" style="font-size: 1.2rem"></i>',s.addEventListener("click",(e=>{c.setAttribute("style",`height: ${a}px`),"code-expand-btn"!==e.target.className?e.target.parentNode.classList.add("expand-done"):e.target.classList.add("expand-done")})),n.appendChild(s)),t.insertBefore(n,t.firstChild)}static init(){const e=document.querySelectorAll("figure.highlight"),t=this;e.forEach((function(e){let n=e.getAttribute("class").split(" ")[1];"plaintext"!==n&&void 0!==n||(n="Code");const o=`<div class="code-lang">${n.toUpperCase()}</div>`;t.createEle(o,e)}))}}class tabs{static init(){this.clickFnOfTabs(),this.backToTop()}static clickFnOfTabs(){document.querySelectorAll("#article-container .tab > button").forEach((function(e){e.addEventListener("click",(function(e){const t=this,n=t.parentNode;if(!n.classList.contains("active")){const e=n.parentNode.nextElementSibling,o=utils.siblings(n,".active")[0];o&&o.classList.remove("active"),n.classList.add("active");const i=t.getAttribute("data-href").replace("#","");[...e.children].forEach((e=>{e.id===i?e.classList.add("active"):e.classList.remove("active")}))}}))}))}static backToTop(){document.querySelectorAll("#article-container .tabs .tab-to-top").forEach((function(e){e.addEventListener("click",(function(){utils.scrollToDest(utils.getEleTop(e.parentElement.parentElement.parentNode),300)}))}))}}window.refreshFn=()=>{scrollFn(),sidebarFn(),setTimeState(),GLOBALCONFIG.comment.enable&&newestCommentInit(),chageTimeFormate(),initObserver(),sco.addRuntime(),sco.hideCookie(),sco.addPhotoFigcaption(),sco.sayhi(),addRightMenuClickEvent(),GLOBALCONFIG.lazyload.enable&&sco.lazyloadImg(),GLOBALCONFIG.lightbox&&sco.lightbox(""),GLOBALCONFIG.randomlinks&&randomLinksList(),PAGECONFIG.toc&&toc.init(),(PAGECONFIG.is_post||PAGECONFIG.is_page)&&(GLOBALCONFIG.hightlight.enable&&hightlight.init(),tabs.init()),PAGECONFIG.comment&&initComment(),PAGECONFIG.is_home&&(showTodayCard(),sco.initbbtalk()),PAGECONFIG.is_page&&"says"===PAGECONFIG.page&&sco.reflashEssayWaterFall(),PAGECONFIG.is_page&&document.getElementById("album_detail")&&sco.reflashEssayWaterFall(),GLOBALCONFIG.covercolor&&coverColor(),set_fest(),sco.initConsoleState(),document.getElementById("history-baidu")&&sco.card_history(),document.getElementById("welcome-info")&&sco.card_welcome(),GLOBALCONFIG.comment.enable&&initializeCommentBarrage()},sco.initTheme();let wleelw_musicPlaying=!1;document.addEventListener("DOMContentLoaded",(function(){window.refreshFn()})),document.addEventListener("pjax:complete",(()=>{window.refreshFn()})),window.onkeydown=function(e){123===e.keyCode&&utils.snackbarShow("å¼€å‘è€…æ¨¡å¼å·²æ‰“å¼€ï¼Œè¯·éµå¾ªGPLåè®®",!1,3e3)};