const changeContent=e=>(""===e||(e=e.replace(/<img.*?src="(.*?)"?[^\>]+>|<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>|<pre><code>.*?<\/pre>|<[^>]+>/g,((e,n,t,a)=>n?"[图片]":t?"[链接]":a?"[代码]":""))).length>150&&(e=e.substring(0,150)+"..."),e),getComment=()=>{const e=document.querySelector("#card-newest-comments .aside-list");twikoo.getRecentComments({envId:GLOBALCONFIG.comment.twikooUrl,region:"",pageSize:6,includeReply:!0}).then((function(e){const n=e.map((e=>({content:changeContent(e.comment),avatar:e.avatar,nick:e.nick,url:`${e.url}#${e.id}`,date:new Date(e.created).toISOString()})));if("/links/"===window.location.pathname||"/links"===window.location.pathname){let e=document.getElementsByClassName("tk-submit "),n=document.getElementsByClassName("el-textarea__inner");n[0].value+="昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我的图床）：\n描述：",n[0].style.height="142px",e.item(0).style.display="none",window.checkForm=function(){const n=document.querySelectorAll('input[onclick="checkForm()"]');let t=!0;n.forEach((e=>{e.checked||(t=!1)})),e.item(0).style.display=t?"block":"none"}}generateHtml(n)})).catch((function(n){e.innerHTML="无法获取评论，请确认相关配置是否正确"}))},generateHtml=e=>{const n=document.querySelector("#card-newest-comments .aside-list");let t=e.length?e.map((e=>`\n    <div class='aside-list-item'>\n      <a href='${e.url}' class='thumbnail'>\n        <img src='${e.avatar}' alt='${e.nick}'>\n        <div class='name'><span>${e.nick}</span></div>\n      </a>\n      <div class='content'>\n        <a class='comment' href='${e.url}'>${e.content}</a>\n        <time class="datetime" datetime="${e.date}"></time>\n      </div>\n    </div>\n  `)).join(""):"没有评论";n.innerHTML=t,window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n),chageTimeFormate()},newestCommentInit=()=>{document.querySelector("#card-newest-comments .aside-list")&&getComment()};