window.onload=()=>{let e,t=[];const n=document.getElementById("search-mask"),c=document.querySelector("#local-search .search-dialog"),s=()=>{window.innerWidth<768&&c.style.setProperty("--search-height",window.innerHeight+"px")},a=()=>{utils.animateOut(c,"search_close .5s"),utils.animateOut(n,"to_hide 0.5s"),window.removeEventListener("resize",s)};utils.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",(()=>{utils.animateIn(n,"to_show 0.5s"),c.style.display="block",setTimeout((()=>{document.querySelector("#local-search .search-box-input").focus()}),100),document.addEventListener("keydown",(function e(t){"Escape"===t.code&&(a(),document.removeEventListener("keydown",e))})),s(),window.addEventListener("resize",s)})),utils.addEventListenerPjax(document.querySelector("#local-search .search-close-button"),"click",a);let o="",l=0;const i=10;let r=[];function d(){const n=document.getElementById("search-results");document.getElementById("search-input").addEventListener("keydown",(function(c){13===c.keyCode&&(n.innerHTML="",o=this.value,r=function(n){return e.search(n).map((e=>t.filter((t=>t.link===e.ref))[0]))}(o),u(r,l),function(e){const t=Math.ceil(e/i),n=document.getElementById("search-pagination");n.innerHTML="";const c=document.createElement("ul");c.className="pagination-list";for(let e=0;e<t;e++){const t=document.createElement("li");t.className="pagination-item",t.textContent=e+1,e===l&&t.classList.add("select"),t.addEventListener("click",(function(){l=e,u(r,e)})),c.appendChild(t)}n.appendChild(c)}(r.length))}))}function u(e,t){const n=document.getElementById("search-results");n.innerHTML="";const c=document.getElementById("search-tips");c.innerHTML="";const s=t*i,a=s+i;if(!e.length){const e=document.createElement("span");return e.className="search-result-empty",e.textContent=GLOBAL_CONFIG.lang.search.empty.replace(/\$\{query}/,o),void n.appendChild(e)}e.slice(s,a).forEach((function(e){const t=document.createElement("li");t.className="search-result-item";const c=document.createElement("a");c.className="search-result-title",c.href=e.link,c.textContent=e.title,t.appendChild(c),n.appendChild(t)}));const l=document.createElement("span");l.className="search-result-count",l.innerHTML=`共 <b>${e.length}</b> 条结果`,c.appendChild(l)}fetch("/search.xml").then((e=>e.text())).then((n=>{let c=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("entry");for(let e=0;e<c.length;e++){let n=c[e],s=n.getElementsByTagName("title")[0].textContent,a=n.getElementsByTagName("url")[0].textContent,o=n.getElementsByTagName("content")[0].textContent;t.push({title:s,link:a,content:o})}e=lunr((function(){this.ref("link"),this.field("title",{boost:10}),this.field("content"),t.forEach((function(e){this.add(e)}),this)}))})).catch((e=>console.error("Error loading search data:",e))),d(),window.addEventListener("DOMContentLoaded",(e=>{d()}))};